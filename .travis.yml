language: python
python:
- '3.6'
services:
- docker
notifications:
  email:
    on_success: change
    on_failure: change
env:
  global:
  - GITHUB="https://github.com"
  - TUSK_VER=0.3.2
  - secure: Vv8Agru45b93751nI1iM8F4NEEhHDFPw8vblaYC7LskG8sAmLc+H5X3Dg+YZHSAYlIiSmY9F/jRjZ7Jrpsk+ouE/UpDWJu7TYi9MU2vSY2eBmvSzc4fhjmAP7oxUPzPSbaF1nJmYQhZdm9AKJ/GWlJ01YCbO4awr+7yleH3Xa5j7cD9e94/WbCY7zATITTFJhceq5BoFiMk/ucgs+sEhCSgfpwDNMtHvIv4EpKc4Er36cSUJTrGwmIO2jDHIjWaQTlI3NtZYLx2b16YrA0b6whGkx7FL3SdigMCihz5InIcO7y9u7TKO8AIpgdO6ty1ixUn+99igDMaBLB0wxoE9PyQnDQz3UAaw4gACMWhR4xKgr2kNaEc0bfevoucSzfU4IxjRFsKKaXG0+mtFOV9/3CQPsyw4xbwnjVtkgmUfbDoNGFkmlVWlhyT0o8MvnfGwefgt9lw8xMhSwj9hPcasK4kn4loQ0PYsjp72n1GOqPxiCPJGm0/wviGzLwk/BqJSHSmfcIFkpMR6ZLPlP65xRH1RN8rTZmHp8QgOaSK+lc51CnnlmJEeNDZw4oluKs9H+A91NI/ymiD0tlK7b1P77UmU1EN1hpKUyKMTTCB81K5Ccndg/OB4SpbgUcxvszwHLsCJLszxVK1Oy4j9CzQSOkWVZxr0EbYNGPc6CNRLb1o=
install:
- wget ${GITHUB}/rliebz/tusk/releases/download/v${TUSK_VER}/tusk_${TUSK_VER}_linux_amd64.deb
- sudo dpkg -i tusk_${TUSK_VER}_linux_amd64.deb
script:
- tusk setup
- tusk check
- tusk docker --action build --tag ${TRAVIS_COMMIT}
deploy:
  provider: releases
  api_key:
    secure: LrnSOrNO7X8DFn5UdOFqKWDjhDZkg9RlXTSN/JIHxRab8BQ/kq3M5EDAroagluRVa1MCZSuoEImkIBv8QH/CsUO1BVPbSEz7q20ostAurbwsRcwEHCvMPY03G+ohkyJJyuDSyFgDv5YW/Jr6HZC+OX0aESSrmwwEgk4TAXWgaY5+rwWXZjhcNPExDnOOSvL//TBIe/se+q78JxsWNYODW+hFk/N/C+/LDUurGxpomNN98c+CGpWl5gSyZVqadWbJxb24CfytfzXh8i2Cao7GBj4wLMrfoYHFAfhb8AOmAgDDsCBlqqji1pEBmTl3RUZghwvaHkKPkMolYSRzOsz/DIWVlgAJesnJ9aDYSf/RQWHVKAUYVicEDWM19eUs9AbCNH6qIKyq9FgU/C9zhRu5cTx4Nny/y6PMCTHY1KYJo069Qvy0AuYQwE8EKoZ/M1WHFgDWnjxxKs645a0fEkJV37wmDCGup9jXHO9WqhfNiFItYDD0SSyMvw+yrcYBNbUIxy5xP42h40CZ0LZOqm65asMvs2zF/s0dXKLXcGtsyAS3WeLI93oapgGBGPdGPcLC21tVich6emTallKeFnZfoX/eWBec67jrMpefDy9W8o23HUpoDIAYkv6PoZlRYq629iaC+p2mKsZuYCKg8aDkDb/l4fD/gP+MHVd2tVCYBzQ=
  skip_cleanup: true
  on:
    repo: co-llabs/plex_notifier
    branch: master
    tags: true
after_deploy:
- tusk docker --action build --tag ${TRAVIS_TAG}
- docker login -u "${DOCKER_USERNAME}" -p "${DOCKER_PASSWORD}"
- docker push ${DOCKER_USERNAME}/plex_notifier:${TRAVIS_TAG}
